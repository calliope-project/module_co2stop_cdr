$schema: "https://json-schema.org/draft/2020-12/schema"
description: "Schema for user-provided configuration files."
type: object
additionalProperties: false
required: [crs, imputation]

$defs:
  crsValue:
    description: "A CRS identifier (e.g. EPSG code as integer or string)."
    oneOf:
      - type: string
      - type: integer

  nonNegativeNumber:
    type: number
    minimum: 0

  boundsMtco2:
    description: "Non-negative lower/upper bounds in MtCO2."
    type: object
    additionalProperties: false
    required: [lower, upper]
    properties:
      lower:
        $ref: "#/$defs/nonNegativeNumber"
      upper:
        $ref: "#/$defs/nonNegativeNumber"

  aggregatedConfig:
    description: "Settings for each aggregated CDR group."
    type: object
    additionalProperties: false
    required: [bounds_mtco2]
    properties:
      bounds_mtco2:
        description: "These bounds will be applied to each shape_id case after aggregation."
        allOf:
          - $ref: "#/$defs/boundsMtco2"

  co2stopConfig:
    description: "Settings for each CDR group in the CO2Stop dataset."
    type: object
    additionalProperties: false
    required: [bounds_mtco2, minimums, remove_remarks]
    properties:
      bounds_mtco2:
        description: "These bounds will be applied to each row in the CO2Stop dataset."
        allOf:
          - $ref: "#/$defs/boundsMtco2"
      minimums:
        description: |
          Minimum values for key reservoir attributes. Cases below them will be dropped.
          IMPORTANT: CO2Stop uses '0' for missing values, making NaN and actual 0 indistinguishable.
          Some of these settings may result in a lot of removed data due to this dataset limitation!
        type: object
        additionalProperties: false
        required: [porosity_ratio, depth_m, reservoir_thickness_m, seal_thickness_m, permeability_md]
        properties:
          porosity_ratio:
            description: Minimum mean porosity ratio
            type: number
            minimum: 0
            maximum: 1
          depth_m:
            description: Minimum mean depth in metres
            $ref: "#/$defs/nonNegativeNumber"
          reservoir_thickness_m:
            description: Minimum mean reservoir thickness in metres
            $ref: "#/$defs/nonNegativeNumber"
          seal_thickness_m:
            description: Minimum seal thickness in metres
            $ref: "#/$defs/nonNegativeNumber"
          permeability_md:
            description: Permeability in millidarcy (md)
            $ref: "#/$defs/nonNegativeNumber"
      remove_remarks:
        description: |
          Remove CO2Stop polygons based on remarks by the dataset authors.
          Note that CO2Stop settings and comments are the only thing used for these filters.
          Quality may vary due to the inconsistent nature of the dataset.
        type: object
        additionalProperties: false
        required: [surface_issues, subsurface_issues, artificial_polygons]
        properties:
          surface_issues:
            description: "Example: land ownership issues."
            type: boolean
          subsurface_issues:
            description: "Example: potable water, geothermal facilities."
            type: boolean
          artificial_polygons:
            description: |
              These are cases where the authors state that polygons do not reflect the actual extent of storage.
              RECOMMENDED TO LEAVE AS 'True'.
            type: boolean

properties:
  crs:
    description: "CRS values to use during projections."
    type: object
    additionalProperties: false
    required: [geographic, projected]
    properties:
      geographic:
        description: "Geographic CRS (for lat/lon operations)."
        allOf:
          - $ref: "#/$defs/crsValue"
      projected:
        description: "Projected CRS (for area operations)."
        allOf:
          - $ref: "#/$defs/crsValue"

  imputation:
    description: "These settings alter how data is processed."
    type: object
    additionalProperties: false
    required: [aggregated, co2stop]
    properties:
      aggregated:
        description: Settings applied after aggregating to the provided shapes file.
        type: object
        additionalProperties: false
        required: [aquifer, gas, oil]
        properties:
          aquifer:
            allOf:
              - $ref: "#/$defs/aggregatedConfig"
          gas:
            allOf:
              - $ref: "#/$defs/aggregatedConfig"
          oil:
            allOf:
              - $ref: "#/$defs/aggregatedConfig"
      co2stop:
        description: Settings applied while preparing / standardising the CO2Stop dataset.
        type: object
        additionalProperties: false
        required: [aquifer, gas, oil]
        properties:
          aquifer:
            allOf:
              - $ref: "#/$defs/co2stopConfig"
          gas:
            allOf:
              - $ref: "#/$defs/co2stopConfig"
          oil:
            allOf:
              - $ref: "#/$defs/co2stopConfig"
